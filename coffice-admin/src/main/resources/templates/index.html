<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Cafe Admin</title>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/css/bootstrap.min.css}"/>
    <script th:src="@{/webjars/popper.js/umd/popper.min.js}"></script>
    <script th:src="@{/webjars/bootstrap/js/bootstrap.min.js}"></script>
    <script type="text/javascript"
            th:src="'https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=' + ${@environment.getProperty('MAP_CLIENT_ID_NAVER')}"></script>
</head>
<body>
<div th:replace="~{fragments/header :: header}">Header</div>
<h1 th:text="'Cafe Admin'"></h1>
<h2 th:text="'activeProfiles'"></h2>
<ul th:each="activeProfile : ${@environment.getActiveProfiles()}">
    <li th:text="${activeProfile}"></li>
</ul>
<div id="map" style="width:100%;height:400px;"></div>
<script>
    const mapOptions = {
        center: new naver.maps.LatLng(37.3595704, 127.105399),
        zoom: 10
    };

    // 네이버 지도 추가
    // const map = new naver.maps.Map('map', mapOptions);

    // 마커 추가
    // const marker = new naver.maps.Marker({
    //     position: new naver.maps.LatLng(37.3595704, 127.105399),
    //     map: map
    // });

    // 화면에 보이는 마커만 그리기
    var map = new naver.maps.Map('map', {
        center: new naver.maps.LatLng(37.3595704, 127.105399),
        zoom: 10
    });

    var MARKER_SPRITE_X_OFFSET = 29;
    var MARKER_SPRITE_Y_OFFSET = 50;

    var MARKER_SPRITE_POSITION = {

        "A0": [0, 0],
        "B0": [MARKER_SPRITE_X_OFFSET, 0],
        "C0": [MARKER_SPRITE_X_OFFSET * 2, 0],
        "D0": [MARKER_SPRITE_X_OFFSET * 3, 0],
        "E0": [MARKER_SPRITE_X_OFFSET * 4, 0],
        "F0": [MARKER_SPRITE_X_OFFSET * 5, 0],
        "G0": [MARKER_SPRITE_X_OFFSET * 6, 0],
        "H0": [MARKER_SPRITE_X_OFFSET * 7, 0],
        "I0": [MARKER_SPRITE_X_OFFSET * 8, 0],

        "A1": [0, MARKER_SPRITE_Y_OFFSET],
        "B1": [MARKER_SPRITE_X_OFFSET, MARKER_SPRITE_Y_OFFSET],
        "C1": [MARKER_SPRITE_X_OFFSET * 2, MARKER_SPRITE_Y_OFFSET],
        "D1": [MARKER_SPRITE_X_OFFSET * 3, MARKER_SPRITE_Y_OFFSET],
        "E1": [MARKER_SPRITE_X_OFFSET * 4, MARKER_SPRITE_Y_OFFSET],
        "F1": [MARKER_SPRITE_X_OFFSET * 5, MARKER_SPRITE_Y_OFFSET],
        "G1": [MARKER_SPRITE_X_OFFSET * 6, MARKER_SPRITE_Y_OFFSET],
        "H1": [MARKER_SPRITE_X_OFFSET * 7, MARKER_SPRITE_Y_OFFSET],
        "I1": [MARKER_SPRITE_X_OFFSET * 8, MARKER_SPRITE_Y_OFFSET],

        "A2": [0, MARKER_SPRITE_Y_OFFSET * 2],
        "B2": [MARKER_SPRITE_X_OFFSET, MARKER_SPRITE_Y_OFFSET * 2],
        "C2": [MARKER_SPRITE_X_OFFSET * 2, MARKER_SPRITE_Y_OFFSET * 2],
        "D2": [MARKER_SPRITE_X_OFFSET * 3, MARKER_SPRITE_Y_OFFSET * 2],
        "E2": [MARKER_SPRITE_X_OFFSET * 4, MARKER_SPRITE_Y_OFFSET * 2],
        "F2": [MARKER_SPRITE_X_OFFSET * 5, MARKER_SPRITE_Y_OFFSET * 2],
        "G2": [MARKER_SPRITE_X_OFFSET * 6, MARKER_SPRITE_Y_OFFSET * 2],
        "H2": [MARKER_SPRITE_X_OFFSET * 7, MARKER_SPRITE_Y_OFFSET * 2],
        "I2": [MARKER_SPRITE_X_OFFSET * 8, MARKER_SPRITE_Y_OFFSET * 2]
    };

    var bounds = map.getBounds(),
        southWest = bounds.getSW(),
        northEast = bounds.getNE(),
        lngSpan = northEast.lng() - southWest.lng(),
        latSpan = northEast.lat() - southWest.lat();

    var markers = [];

    for (var key in MARKER_SPRITE_POSITION) {

        var position = new naver.maps.LatLng(
            southWest.lat() + (latSpan * Math.random()),
            southWest.lng() + (lngSpan * Math.random())
        );

        var marker = new naver.maps.Marker({
            map: map,
            position: position,
            title: key,
            zIndex: 100
        });

        markers.push(marker);
    }

    naver.maps.Event.addListener(map, 'zoom_changed', function () {
        updateMarkers(map, markers);

    });

    naver.maps.Event.addListener(map, 'dragend', function () {
        updateMarkers(map, markers);
    });

    function updateMarkers(map, markers) {

        var mapBounds = map.getBounds();
        var marker, position;

        for (var i = 0; i < markers.length; i++) {

            marker = markers[i]
            position = marker.getPosition();

            if (mapBounds.hasLatLng(position)) {
                showMarker(map, marker);
            } else {
                hideMarker(map, marker);
            }
        }
    }

    function showMarker(map, marker) {

        if (marker.setMap()) return;
        marker.setMap(map);
    }

    function hideMarker(map, marker) {

        if (!marker.setMap()) return;
        marker.setMap(null);
    }
</script>
</body>
</html>
